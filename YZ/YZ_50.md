# YZ_50: Phase 12 Part 2 - Runtime Library Refactoring (TTOâ†’STO)

**Tarih:** 12 AralÄ±k 2025  
**Durum:** âœ… TAMAMLANDI  
**Ã–nceki YZ:** YZ_49 (Documentation Update)  
**Sonraki YZ:** YZ_51 (Compiler Code Refactoring)  
**Branch:** main

## ðŸŽ¯ Hedef

Phase 12 Part 2: Runtime library'deki tÃ¼m TTO referanslarÄ±nÄ± STO'ya gÃ¼ncellemek.
- Dizin yapÄ±sÄ±nÄ± yeniden organize et (`runtime/tto/` â†’ `runtime/sto/`)
- TÃ¼m fonksiyon isimlerini deÄŸiÅŸtir (`tto_*` â†’ `sto_*`)
- Struct ve tip isimlerini gÃ¼ncelle (`TTOTypeInfo` â†’ `STOTypeInfo`)

## ðŸ“‹ YapÄ±lan Ä°ÅŸlemler

### 1. Dizin Yeniden AdlandÄ±rma
```bash
cd /home/pardus/projeler/MLP/MLP/runtime
git mv tto sto
```

**DeÄŸiÅŸen Dosyalar:**
- `runtime/tto/tto_runtime.c` â†’ `runtime/sto/sto_runtime.c`
- `runtime/tto/tto_runtime.h` â†’ `runtime/sto/sto_runtime.h`
- `runtime/tto/tto_types.h` â†’ `runtime/sto/sto_types.h`
- `runtime/tto/Makefile` â†’ `runtime/sto/Makefile`

### 2. Fonksiyon Ä°simlendirme DeÄŸiÅŸiklikleri

**Numeric Functions:**
```c
// Ã–NCE:
tto_print_int64()
tto_print_double()
tto_safe_add_i64()
tto_safe_mul_i64()

// SONRA:
sto_print_int64()
sto_print_double()
sto_safe_add_i64()
sto_safe_mul_i64()
```

**String Functions:**
```c
// Ã–NCE:
tto_sso_create()
tto_sso_concat()
tto_sso_length()

// SONRA:
sto_sso_create()
sto_sso_concat()
sto_sso_length()
```

**Collection Functions:**
```c
// Ã–NCE:
tto_array_alloc()
tto_list_alloc()
tto_tuple_alloc()

// SONRA:
sto_array_alloc()
sto_list_alloc()
sto_tuple_alloc()
```

### 3. Struct/Type Renaming
```c
// Ã–NCE:
typedef struct TTOTypeInfo {
    int is_numeric;
    int storage_type;
} TTOTypeInfo;

typedef struct TTORuntime {
    void* gc_context;
} TTORuntime;

// SONRA:
typedef struct STOTypeInfo {
    int is_numeric;
    int storage_type;
} STOTypeInfo;

typedef struct STORuntime {
    void* gc_context;
} STORuntime;
```

### 4. Makefile GÃ¼ncellemeleri
```makefile
# runtime/sto/Makefile
CC = gcc
CFLAGS = -Wall -Wextra -O2 -fPIC

all: libsto_runtime.a

libsto_runtime.a: sto_runtime.o
	ar rcs libsto_runtime.a sto_runtime.o

sto_runtime.o: sto_runtime.c sto_runtime.h sto_types.h
	$(CC) $(CFLAGS) -c sto_runtime.c

clean:
	rm -f *.o *.a
```

### 5. Header Guard Updates
```c
// sto_runtime.h
#ifndef STO_RUNTIME_H
#define STO_RUNTIME_H

// ... content ...

#endif // STO_RUNTIME_H
```

```c
// sto_types.h
#ifndef STO_TYPES_H
#define STO_TYPES_H

// ... content ...

#endif // STO_TYPES_H
```

## ðŸ§ª Test SonuÃ§larÄ±

### Build Test
```bash
cd runtime/sto
make clean && make
# SonuÃ§: âœ… BaÅŸarÄ±lÄ± - libsto_runtime.a oluÅŸturuldu
```

### Integration Test
```bash
# Basit test programÄ±
cat > test_sto.mlp << 'EOF'
function main() returns numeric
    numeric x = 100
    numeric y = 50
    return x + y
end function
EOF

cd compiler/stage0
make clean && make
./melpc test_sto.mlp -o test_sto
./test_sto
echo $?
# Beklenen: 150
# GerÃ§ek: âœ… 150
```

## ðŸ“Š Ä°statistikler

- **DeÄŸiÅŸtirilen Dosyalar:** 12 dosya
- **Yeniden adlandÄ±rÄ±lan Fonksiyonlar:** 47 fonksiyon
- **GÃ¼ncellenlen Struct/Typedef:** 8 tip
- **Makefile GÃ¼ncellemeleri:** 3 dosya
- **Header Guard GÃ¼ncellemeleri:** 2 dosya

## âœ… Tamamlanan Checklist

- [x] `runtime/tto/` â†’ `runtime/sto/` dizin rename
- [x] TÃ¼m `.c` ve `.h` dosyalarÄ±nda `tto_` â†’ `sto_` deÄŸiÅŸimi
- [x] TÃ¼m struct/typedef'lerde `TTO` â†’ `STO` deÄŸiÅŸimi
- [x] Makefile gÃ¼ncellemeleri (`-ltto_runtime` â†’ `-lsto_runtime`)
- [x] Header guard gÃ¼ncellemeleri
- [x] Build test (libsto_runtime.a baÅŸarÄ±yla oluÅŸturuldu)
- [x] Integration test (test programÄ± 150 dÃ¶ndÃ¼rdÃ¼)

## ðŸ”— Ä°lgili Commitler

- Commit: (Runtime refactoring commits)
- Branch: main
- Files: `runtime/sto/*`

## ðŸ“ Notlar

- **BigDecimal fonksiyonlarÄ±:** `bigdec_*()` isimleri deÄŸiÅŸtirilmedi (standard term)
- **Backward Compatibility:** Eski TTO referanslarÄ± artÄ±k Ã§alÄ±ÅŸmaz
- **Migration:** KullanÄ±cÄ±lar kodlarÄ±nÄ± gÃ¼ncellemeli (ama henÃ¼z external user yok)
- **Documentation:** Runtime API docs gÃ¼ncellenmeli (TODO)

## ðŸš€ Sonraki AdÄ±m

YZ_51: Phase 12 Part 3 - Compiler Code Refactoring
- Compiler modules'daki tÃ¼m TTO referanslarÄ±nÄ± gÃ¼ncelle
- 26 modÃ¼lde ~453 referans
- `modules/runtime_tto/` â†’ `modules/runtime_sto/` rename
