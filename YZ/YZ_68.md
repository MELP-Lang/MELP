# YZ_68 - String Comparison Bug Fix (Devam)

## Görev
Phase 17 String Support - String karşılaştırma operatörlerinde bug fix (YZ_67'den devam)

## Mevcut Durum

### ✅ Tamamlanan İşler (YZ_67)
1. **Optimizer Bug Fix**: `statement_optimize.c` içinde `is_constant_comparison()` fonksiyonuna string kontrolü eklendi
   - String karşılaştırmaları artık optimizer tarafından silinmiyor
   - `if (cmp->is_string) return 0;` kontrolü eklendi

2. **Assembly Kod Üretimi Güncellendi**: `comparison_codegen.c`'de 3 fonksiyon güncellendi
   - `test %rax, %rax` yerine `cmpq $0, %rax` kullanılıyor
   - `sets/setz/setns` yerine `setl/sete/setg/setle/setge/setne` kullanılıyor
   - Değişiklikler:
     - `comparison_generate_code()` - satır 69
     - `comparison_generate_conditional_jump()` - satır 146
     - `comparison_generate_code_with_chain()` - satır 220

### ❌ Aktif Sorun
**`<` operatörü çalışmıyor!**

Test sonuçları:
```
PASS: apple == apple  ✅
FAIL: apple >= banana ❌ (<  operatörü FALSE döndürüyor, TRUE olmalı)
PASS: banana > apple  ✅
```

### Assembly Kodu
Üretilen assembly doğru görünüyor:
```asm
call mlp_string_compare  # Returns -1 for "apple" < "banana"
cmpq $0, %rax           # Compare rax with 0
movq $0, %rax           # Clear rax
setl %al                # Set al if less (should set to 1)
test %rax, %rax         # Test rax (should be 1)
je .if_else_2           # Jump if zero - BUT IT'S JUMPING!
```

### Şüpheli Noktalar
1. `setl` instruction doğru mu? (SF != OF kontrolü yapıyor)
2. `cmpq $0, %rax` operand sırası doğru mu? (AT&T syntax: dest - src)
3. Test programla doğruladık - teoride çalışması gerekiyor ama pratikte çalışmıyor

### Test Dosyaları
- `/home/pardus/projeler/MLP/MLP/examples/basics/test_with_debug.mlp` - Çalışan test
- `/home/pardus/projeler/MLP/MLP/examples/basics/test_all_comparisons.mlp` - Bug'ı gösteren test
- `/tmp/test_all.s` - Derlenmiş binary

## İncelenmesi Gereken Dosyalar
1. `compiler/stage0/modules/comparison/comparison_codegen.c` (satır 60-110, 140-185, 214-245)
2. `runtime/stdlib/mlp_string.c` - `mlp_string_compare()` fonksiyonu (satır 126)

## Öneri Yaklaşımlar
1. **GDB ile debug**: Gerçek çalışma zamanında `%rax` değerini kontrol et
2. **Assembly'yi kontrol et**: `setl` yerine başka instruction kombinasyonu dene
3. **strcmp sonucunu kontrol et**: `mlp_string_compare()` gerçekten negatif değer mi döndürüyor?
4. **Flag'leri kontrol et**: `cmpq` sonrası flag'ler doğru set ediliyor mu?

## Hızlı Test Komutu
```bash
cd /home/pardus/projeler/MLP/MLP/compiler/stage0/modules/functions
./functions_compiler ../../../../examples/basics/test_all_comparisons.mlp /tmp/test_all.s
LD_LIBRARY_PATH=../../../../runtime/stdlib:../../../../runtime/sto /tmp/test_all.s
```

Beklenen çıktı:
```
Testing mlp_string_compare...
PASS: apple == apple
PASS: apple < banana    ← Şu anda FAIL veriyor
PASS: banana > apple
```

## Not
YZ_67'de çok debugging yapıldı ama kök neden bulunamadı. Taze bir bakış açısı gerekiyor.
