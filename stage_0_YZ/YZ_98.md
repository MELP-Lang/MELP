# YZ_98 - Function Call Single Argument Bug Fix

**Tarih:** 20 AralÄ±k 2025  
**Branch:** `stage1_while_body_YZ_30`  
**Durum:** âœ… TAMAMLANDI

---

## ğŸ“‹ Sorun TanÄ±mÄ±

Tek argÃ¼manlÄ± fonksiyon Ã§aÄŸrÄ±larÄ± argÃ¼manÄ± kaybediyordu.

### Ã–rnek:
```pmpl
function classify(numeric x) as numeric
    return x
end_function

function main() as numeric
    return classify(3)  -- âŒ ArgÃ¼man '3' push edilmiyordu!
end_function
```

### Assembly Ã‡Ä±ktÄ±sÄ± (Ã–NCE):
```asm
# Function call: classify() with 0 args  <-- 0 args!
call classify  # No argument in %rdi
```

---

## ğŸ” KÃ¶k Neden Analizi

Problem `arithmetic_parser.c` iÃ§indeki function call vs list access ayrÄ±mÄ±ndaydÄ±.

### Sorunlu MantÄ±k:
1. Parser `identifier(...)` gÃ¶rÃ¼nce function mÄ± list mi karar veriyor
2. `function_is_known()` tanÄ±nmayan fonksiyonlarÄ± `looks_like_function = 0` yapÄ±yordu
3. Peek-ahead logic sadece `;` (semicolon) kontrol ediyordu
4. Tek argÃ¼manlÄ± Ã§aÄŸrÄ±larda `;` olmadÄ±ÄŸÄ± iÃ§in **list access** olarak yorumlanÄ±yordu!

### Hata Yeri:
`arithmetic_parser.c` satÄ±r 990-1020 arasÄ± peek logic:
```c
// Eski kod - sadece ';' kontrol ediyordu
if (peek3->type == TOKEN_SEMICOLON) {
    looks_like_function = 1;  // Sadece Ã§oklu arg iÃ§in!
}
// ')' kontrolÃ¼ YOK â†’ tek arg list olarak yorumlanÄ±yordu
```

---

## âœ… Ã‡Ã¶zÃ¼m

### Strateji:
Her `identifier(...)` pattern'ini function call olarak kabul et.
List access iÃ§in `list[i]` syntax'Ä± kullanÄ±lmalÄ±.

### DeÄŸiÅŸiklik:
```c
// YZ_98: Simplified decision - ANY identifier followed by '(' is a function call
if (!looks_like_function) {
    // Since we're at TOKEN_LPAREN, treat it as function call
    looks_like_function = 1;
}
```

### Neden Bu YaklaÅŸÄ±m?
1. MELP'te list access iÃ§in `[]` syntax'Ä± zaten var
2. `list(i)` vs `func(i)` ayrÄ±mÄ± belirsiz
3. Peek-ahead mantÄ±ÄŸÄ± karmaÅŸÄ±k ve hata eÄŸilimli
4. Basit Ã§Ã¶zÃ¼m daha gÃ¼venilir

---

## ğŸ§ª Test SonuÃ§larÄ±

### Tek ArgÃ¼man:
```pmpl
function classify(numeric x) as numeric
    return x
end_function

function main() as numeric
    return classify(3)
end_function
```
**SonuÃ§:** Return code: 3 âœ…

### Ä°ki ArgÃ¼man (Ä°lk):
```pmpl
function add(numeric a; numeric b) as numeric
    return a
end_function

function main() as numeric
    return add(10; 20)
end_function
```
**SonuÃ§:** Return code: 10 âœ…

### Ä°ki ArgÃ¼man (Ä°kinci):
```pmpl
function add(numeric a; numeric b) as numeric
    return b
end_function

function main() as numeric
    return add(10; 20)
end_function
```
**SonuÃ§:** Return code: 20 âœ…

---

## ğŸ“ Assembly Ã‡Ä±ktÄ±sÄ± (SONRA)

```asm
# Function: main
main:
    pushq %rbp
    movq %rsp, %rbp

    # Arithmetic expression
    # Function call: classify()
    movq $3, %r10  # Literal
    pushq %r10  # Save arg 1
    popq %rdi  # Restore arg 1
    call classify
    movq %rax, %r8  # Function return value
    # Result in r8 (integer) or xmm0 (float)
    movq %r8, %rax  # Return value
    jmp .Lmain_return
```

âœ… ArgÃ¼man `3` doÄŸru ÅŸekilde `%rdi` register'Ä±na konuyor!

---

## ğŸ“ DeÄŸiÅŸen Dosyalar

| Dosya | DeÄŸiÅŸiklik |
|-------|------------|
| `compiler/stage0/modules/arithmetic/arithmetic_parser.c` | SatÄ±r 990-1000: Peek logic basitleÅŸtirildi |
| `NEXT_AI_START_HERE.md` | YZ tamamlandÄ± olarak iÅŸaretlendi |

---

## ğŸ¯ Stage 0 Durumu

### ArtÄ±k Ã‡alÄ±ÅŸan Ã–zellikler:
- âœ… Functions (declaration, call, return)
- âœ… **Function call with arguments** (YZ_98 - YENÄ°!)
- âœ… If-else-else_if (YZ_36)
- âœ… While loops
- âœ… For loops
- âœ… Variables
- âœ… Arrays
- âœ… Structs
- âœ… Enums
- âœ… Switch-case
- âœ… Print statements
- âœ… Import (path resolution)

### Kalan Blocker'lar:
1. Import execution
2. While loop return (opsiyonel)

**Tahmini Tamamlanma:** %65-70

---

## ğŸ“š Notlar

### Syntax KuralÄ±:
MELP'te artÄ±k:
- `func(arg)` = Function call
- `list[i]` = List/Array access
- `list(i)` syntax'Ä± **desteklenmiyor** (function call olarak yorumlanÄ±r)

### Ä°lgili Belgeler:
- `pmlp_kesin_sozdizimi.md` - PMPL syntax referansÄ±
- `NEXT_AI_START_HERE.md` - Sonraki gÃ¶revler

---

*YZ_98 tarafÄ±ndan oluÅŸturuldu - 20 AralÄ±k 2025*
