// Integration Test for Stage 3 Pipeline
// Tests: lexer → parser → memory → codegen
// Focus: GC integration and full compilation

fn factorial(n: i32) -> i32 {
    if n <= 1 {
        return 1
    }
    return n * factorial(n - 1)
}

fn allocate_data(size: i32) -> i32 {
    // This should trigger gc_alloc in codegen
    let data = size * 8
    return data
}

fn main() -> i32 {
    // Test arithmetic
    let x = 5
    let y = 10
    let sum = x + y
    
    // Test comparison
    if sum > 10 {
        let result = factorial(5)
    }
    
    // Test allocation (should use GC)
    let allocated = allocate_data(10)
    
    // Test while loop
    let i = 0
    while i < 3 {
        i = i + 1
    }
    
    return 0
}
