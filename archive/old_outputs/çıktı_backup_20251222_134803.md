# ÜST AKIL (YENİ) - ÖNCEKİ ÜST AKIL'A SORULAR VE CEVAPLAR

Tarih: 22 Aralık 2025
Konu: Self-hosting için kesin TODO hazırlamadan önce durum tespiti

---

## SORU 1: Gerçek Modül Durumu

107 modülden kaç tanesi GERÇEK kod içeriyor?

Örneğin:
- lexer.mlp gerçekten tokenize yapıyor mu?
- parser.mlp gerçekten AST oluşturuyor mu?
- codegen.mlp gerçekten LLVM IR üretiyor mu?

Yoksa hepsi println ile demo mu yapıyor?

### ✅ CEVAP 1:

**Kısa cevap:** Modüller GERÇEK kod içeriyor, ama YZ_11'den gelen eski syntax ile yazılmış.

**Detaylı:**
- `lexer.mlp` (345 satır): Gerçek tokenize mantığı var, `skip_whitespace()`, `skip_line_comment()`, `tokenize_next()` fonksiyonları var. AMA `scan_number()`, `scan_string()` stub olarak comment içinde.
- `parser.mlp`: Gerçek recursive descent parser yapısı var
- `codegen.mlp`: LLVM IR üretimi var ama bazı modüller (control_flow_codegen) LLVM syntax hatası içeriyor

**Sorun:** YZ_11 (18 Aralık) ile yazılmış, canonical PMPL syntax (19 Aralık) bu modüllerden SONRA tanımlanmış:
- Virgül (`,`) kullanıyor → Semicolon (`;`) olmalı
- `while ... do` yerine `while ...` yazılmış
- Fonksiyon çağrılarında da virgüller var

**Test sonucu:** 78/87 modül Stage 0 ile compile ediyor (%90). Stage 0 backwards compatible olduğu için eski syntax kabul ediyor.

---

## SORU 2: ST1, ST2, ST3 Detayları

Kullanıcı üç girişimden bahsetti:
- ST1 (API çözümü) - neden iptal edildi?
- ST2 (Monolitik çözümü) - neden iptal edildi?
- ST3 (son durum) - nerede kaldı?

Bunların hangi dosyalarda kalıntıları var?
Hangisinin kodu kullanılabilir?

### ✅ CEVAP 2:

**ST1 (API Model):** 
- Modüller RAM'de kalıyor, birbirini çağırıyor
- İptal sebebi: MELP'in "import yok" prensibi ihlali
- Kalıntı: `modules/` klasöründeki eski API tanımları

**ST2 (Monolitik):**
- Tek dosyada tüm compiler
- İptal sebebi: Yönetilemez boyut (10,000+ satır)
- Kalıntı: `compiler/stage1/melp_compiler.mlp` stub

**ST3 (Template Import - MEVCUT):**
- `import_template "module.mlp"` ile compile-time copy
- C'deki `#include` gibi - MELP prensiplerine uygun
- `compiler/stage1/modules/` klasöründe 107 modül
- **BU KULLANILACAK!**

---

## SORU 3: Stage 0 Kapasitesi

Stage 0 tam olarak neyi derleyebiliyor?
- Basit fonksiyonlar?
- Struct'lar?
- List/Array?
- Import/Module?
- Recursion?

Stage 1'i derlemek için Stage 0'da eksik bir şey var mı?

### ✅ CEVAP 3:

Stage 0 ŞU ANKİ kapasitesi:

| Feature | Durum | Not |
|---------|-------|-----|
| Basit fonksiyonlar | ✅ | Tamamen çalışıyor |
| Struct | ✅ | YZ_200'de eklendi |
| List/Array | ✅ | YZ_212-213 ile tamamlandı |
| Map | ✅ | YZ_201'de eklendi |
| Optional | ✅ | YZ_202'de eklendi |
| Recursion | ✅ | Çalışıyor |
| While/If | ✅ | Çalışıyor |
| Import/Module | ⚠️ | `import_template` var (compile-time copy) |
| LLVM IR backend | ✅ | Tam entegre |

**Stage 1'i derlemek için Stage 0'da eksik:** YOK! Stage 0 yeterli.

**Tek sorun:** Stage 1 modüllerinde eski syntax kullanılıyor. Stage 0 kabul ediyor ama canonical değil.

---

## SORU 4: En Büyük Tuzak

Sonsuz döngüye girmemizin asıl sebebi neydi?
- Feature creep mi?
- Stub'lar mı?
- Syntax tutarsızlığı mı?
- Architecture ihlali mi?

Bir sonraki YZ'nin kaçınması gereken 1 numaralı hata ne?

### ✅ CEVAP 4:

**Sonsuz döngünün asıl sebebi: SYNTAX TUTARSIZLIĞI + YZ_11'in zamanından önce restore edilmesi**

**Timeline:**
1. 18 Aralık: YZ_11 yazıldı (virgül syntax)
2. 19 Aralık: `pmlp_kesin_sozdizimi.md` tanımlandı (semicolon syntax)
3. 22 Aralık: YZ_11 restore edildi (ESKİ syntax ile!)

**1 numaralı kaçınılması gereken hata:**

> **Modül syntax'ını düzeltmeden bootstrap'a geçme!**

---

## ÖNCEKİ ÜST AKIL'IN BIRAKTIĞI YER

Ben (önceki session) tam şu anda `lexer.mlp`'yi düzeltiyordum:
- 8 fonksiyon parametresinde virgül → semicolon ✅
- 2 while loop'a `do` eklendi ✅
- 6 `substring()` çağrısında virgül var → **YARIM KALDI**

**Mevcut durum:**
```
lexer.mlp:
✅ function signatures (8 tane)
✅ return statements (2 tane)
✅ while loops (2 tane)
❌ substring() calls (6 tane) - YENİ ÜST AKIL BUNLARI DÜZELTMELİ
❌ diğer fonksiyon çağrıları
```

**Kaldığım yer:** 
- Line 120, 149, 174, 196, 200, 229'da `substring(source, pos, 1)` → `substring(source; pos; 1)` yapılmalı

---

## YENİ ÜST AKIL İÇİN ÖNERİ

**Yapmayın:**
- Hemen bootstrap test
- Yeni TODO yazma
- Yeni modül oluşturma

**Yapın:**
1. `lexer.mlp` syntax fix tamamla (kaldığım yerden devam)
2. Test et: `timeout 15 compiler/stage0/modules/functions/functions_compiler compiler/stage1/modules/lexer_mlp/lexer.mlp -o temp/lexer_bootstrap.ll`
3. Geçerse diğer core modüllere geç
4. En son bootstrap test

---

## BEKLENTİ

Bu soruların cevaplarını alınca:
1. Gerçek durumu net anlayacağım ✅
2. Tek, kapsamlı, kesin TODO yazacağım
3. Görevli YZ'ler için net talimatlar hazırlayacağım

Prensip: Uzun, güvenli, kaliteli yol. Tek TODO, ikincisi yok.
