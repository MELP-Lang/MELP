# YZ_47: println() Fix (Reserved Keyword) - PARTIAL

**Tarih:** 12 AralÄ±k 2025  
**Durum:** âœ… Parser tamamlandÄ±, âŒ Codegen eksik  
**Base:** YZ_46 (4165509)  
**Commit:** 54af3c5

---

## ğŸ¯ Hedef

For loop iÃ§inde `println(i)` Ã§alÄ±ÅŸmÄ±yordu. Sorun: `println(i)` ifadesi `list(0)` gibi array access olarak parse ediliyordu.

---

## âœ… YapÄ±lanlar

### 1. TOKEN_PRINTLN Reserved Keyword

**Dosya:** `modules/lexer/lexer.h`, `lexer.c`

```c
// lexer.h
TOKEN_PRINTLN,         // println builtin (YZ_48)

// lexer.c  
else if (strcmp(value, "println") == 0) type = TOKEN_PRINTLN;
```

**Neden Ã¶nemli:** `println` artÄ±k identifier deÄŸil, reserved keyword. Parser hemen ayÄ±rt edebiliyor.

### 2. Statement Parser

**Dosya:** `modules/statement/statement_parser.c`

```c
// TOKEN_PRINTLN handling
if (tok->type == TOKEN_PRINTLN) {
    // Parse: println(expr)
    // Return: STMT_EXPRESSION with ArithmeticExpr
}
```

**Pattern:** `println(expr)` â†’ `STMT_EXPRESSION` statement type

### 3. Statement Codegen

**Dosya:** `modules/statement/statement_codegen.c`

```c
case STMT_EXPRESSION: {
    ArithmeticExpr* expr = (ArithmeticExpr*)stmt->data;
    if (expr) {
        arithmetic_generate_code(output, expr, func);
    }
    break;
}
```

---

## âŒ Sorun

`arithmetic_generate_code()` sadece expression'Ä± evaluate ediyor, **println() Ã§aÄŸrÄ±sÄ±nÄ± generate etmiyor**.

### Test SonuÃ§larÄ±

```bash
# test_for_count.mlp (arithmetic)
for i = 0 to 10
    sum = sum + i
end for
# âœ… Exit: 55 (1+2+...+10 = DOÄRU!)

# test_for_simple.mlp (println)
for i = 0 to 5
    println(i)
end for
# âŒ Exit: 0 (println Ã§aÄŸrÄ±lmadÄ±!)
```

### Assembly Output

```asm
# test_for_simple.s.s
# Arithmetic expression
movq -8(%rbp), %r8  # Load i
# Result in r8 (integer) or xmm0 (float)
# âŒ PRINTLN Ã‡AÄRISI YOK!
```

---

## ğŸ”§ TODO: Sonraki YZ Session (YZ_48)

### Ã‡Ã¶zÃ¼m 1: Function Call MekanizmasÄ± (Ã–NERÄ°LEN)

```c
// arithmetic_codegen.c iÃ§inde
if (expr->type == EXPR_FUNCTION_CALL) {
    if (strcmp(expr->function_name, "println") == 0) {
        // Generate println call
        // 1. Evaluate argument
        // 2. Call tto_print_int() or tto_print_float()
    }
}
```

### Ã‡Ã¶zÃ¼m 2: Builtin Module OluÅŸtur

```
modules/
  builtin/
    builtin_parser.c   # println, print, input, etc.
    builtin_codegen.c  # stdlib Ã§aÄŸrÄ±larÄ±
```

---

## ğŸ“Š Zincir Durumu

```
âœ… YZ_46 (4165509) - Phase 11 tamamlanmÄ±ÅŸ, token structure
    â†“
âœ… YZ_48 (54af3c5) - println() parser fix (CURRENT)
    â†“
âŒ YZ_47 (f2d1ed5) - Token merging BOZUK, compiler Ã§alÄ±ÅŸmÄ±yor
    â†“
â“ YZ_49+ - println() codegen + YZ_47 fix
```

### Karar

- **YZ_46'ya dÃ¶n** âœ… (yapÄ±ldÄ±)
- **println fix uygula** âœ… (parser tamamlandÄ±)
- **YZ_47'yi atla** âœ… (token merging bozuk)
- **YZ_49: println codegen** â­ï¸ (sonraki AI)
- **YZ_50: YZ_47 dÃ¼zelt** â­ï¸ (token merging fix)

---

## ğŸ“ Dersler

### Pattern 1: Reserved Keywords for Builtins

**âŒ YanlÄ±ÅŸ:**
```
println â†’ TOKEN_IDENTIFIER + TOKEN_LPAREN
list    â†’ TOKEN_IDENTIFIER + TOKEN_LPAREN
// Parser ayÄ±rt edemiyor!
```

**âœ… DoÄŸru:**
```
println â†’ TOKEN_PRINTLN (reserved)
list    â†’ TOKEN_IDENTIFIER
// Parser hemen ayÄ±rt ediyor!
```

### Pattern 2: Two-Phase Fix

1. **Phase 1:** Parser fix (syntax tanÄ±) âœ…
2. **Phase 2:** Codegen fix (assembly Ã¼ret) â­ï¸

**Avantaj:** Her aÅŸama test edilebilir, izole problem Ã§Ã¶zÃ¼mÃ¼.

### Pattern 3: Git Bisect Mentality

**Sorun:** For loops 47 session Ã§alÄ±ÅŸtÄ±, ÅŸimdi bozuk?  
**AraÅŸtÄ±rma:** YZ_16'dan beri test vardÄ± ama hiÃ§ Ã§alÄ±ÅŸtÄ±rÄ±lmamÄ±ÅŸ!  
**GerÃ§ek:** For loops arithmetic ile Ã§alÄ±ÅŸÄ±yordu, println() hiÃ§ test edilmedi.

**Ders:** "Ã‡alÄ±ÅŸÄ±yor" â‰  "Test edildi"

---

## ğŸ”— Ä°lgili Dosyalar

- `compiler/stage0/test_for_simple.mlp` - println test
- `compiler/stage0/test_for_count.mlp` - arithmetic test âœ…
- `CRITICAL_PATTERNS.md` - Pattern #2: Reserved Keywords
- `ARCHITECTURE.md` - Composition Pattern

---

## ğŸ“ Notlar

### YZ_47 Neden AtlandÄ±?

**Sorun:** Token merging ("end for" â†’ TOKEN_END_FOR) parser'Ä± bozdu.  
**Test:** HiÃ§bir program compile olmuyor (test_for_count bile).  
**Karar:** YZ_47'yi sonra yeni AI'ya dÃ¼zelttiririz.

### Phase 11 Durumu

- âœ… **Phase 11 teknik olarak tamamlandÄ±** (YZ_42'de)
- âœ… **YZ_43-46:** Incremental compilation + self-hosting eklendi
- âŒ **YZ_47:** Token merging bozuk
- â­ï¸ **YZ_48:** println() parser fix (codegen eksik)

**SonuÃ§:** Phase 11 saÄŸlam, YZ_47 ve println codegen sonraki session'larda dÃ¼zeltilecek.

---

**YZ_48 Session Ã–zet:**  
- âœ… Problemi doÄŸru tespit ettik (println vs list ambiguity)
- âœ… Parser fix tamamlandÄ± (reserved keyword)
- âœ… YZ_46 bazÄ±nda temiz Ã§alÄ±ÅŸÄ±yor
- âŒ Codegen eksik (sonraki AI'ya bÄ±rakÄ±ldÄ±)
- âœ… Git history temiz tutuldu (YZ_47 atlandÄ±)

**Sonraki AI iÃ§in:** `arithmetic_generate_code()` iÃ§inde EXPR_FUNCTION_CALL case'i ekle ve println() iÃ§in stdlib Ã§aÄŸrÄ±sÄ± yap.
